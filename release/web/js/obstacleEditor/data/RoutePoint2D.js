var RoutePointEvent={LINK_LINE_CHANGED:"link line changed"};class RoutePoint2D extends ObjectPoint{constructor(t=null,e=new Pose,i=!1,s=1,n=500,r=RoutePointLockType.SPEED){super(ObjectPointType.OBSTACLE_ROUTE_POINT),this.x=e.vec3.x,this.y=e.vec3.y,this.z=null!=t?t.mapInfo.objectZ:0,this.rotation=2*Math.atan2(e.quat.z,e.quat.w)/Math.PI*180,this.timestampInterval=s,this.speed=n,this.isReversing=i,this.lockType=r,this.obstacle=null,this.index=-1}getTimestampSec(){return-1==this.index?0:this.hasPrevRoutePoint()?this.prevRoutePoint().getTimestampSec()+this.timestampInterval:this.timestampInterval}clone(){var t=new RoutePoint2D;return t.x=this.x,t.y=this.y,t.z=this.z,t.rotation=this.rotation,t.timestampInterval=this.timestampInterval,t.isReversing=this.isReversing,t}toJson(){var t=this.rotation/180*Math.PI;return{quat:{x:0,y:0,z:Math.sin(t/2),w:Math.cos(t/2)},tran:{x:this.x,y:this.y,z:this.z},is_reversing:this.isReversing,timestamp_interval:this.timestampInterval,speed:this.speed,lock_type:this.lockType}}_setValueInternal(...t){return super.setValue(...t)}setValue(...t){var e=super.setValue(...t);if(0!=e.size){var i=n(["isReversing","x","y","rotation"]),s=n(["timestampInterval","speed"]);assert(!(i&&s)),s&&this._refreshTimeOrSpeed(e),i&&(this.hasPrevRoutePoint()&&this.prevRoutePoint()._refreshLinkLine(),this._refreshLinkLine(),this._refreshTimeOrSpeed())}function n(t){for(var i of t)if(e.has(i))return!0;return!1}}static getBezierControlPoint(t,e){function i(t,e,i,s){var n=t.rotation/180*Math.PI,r=Math.sin(n),h={x:Math.cos(n),y:r};return i&&(h={x:-h.x,y:-h.y}),0==e&&(h={x:-h.x,y:-h.y}),new Vec2(t.x+h.x*s,t.y+h.y*s)}var s=Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),n=Math.min(500,s/2.5);return[i(t,!0,t.isReversing,n),i(e,!1,t.isReversing,n)]}_refreshLinkLine(){this.hasNextRoutePoint()?(this.bezierCurve=function(){var t=this.nextRoutePoint(),e=new Vec2(this.x,this.y),i=new Vec2(t.x,t.y),s=RoutePoint2D.getBezierControlPoint(this,t);return new CubicBezierCurve(e,s[0],s[1],i)}.call(this),this.linkLineLength=this.bezierCurve.getLength()):(this.bezierCurve=null,this.linkLineLength=0),this.sendEvent(RoutePointEvent.LINK_LINE_CHANGED,this.bezierCurve)}_refreshTimeOrSpeed(t=null){if(0!=this.hasPrevRoutePoint()){var e=this.prevRoutePoint(),i=e.linkLineLength,s=e.speed;(null==t||!t.has("speed"))&&(!(null==t||!t.has("timestampInterval"))||this.lockType==RoutePointLockType.TIMESTAMP_FROM_PREV_POINT)?this._setValueInternal("speed",2*i/this.timestampInterval-s):this._setValueInternal("timestampInterval",2*i/(s+this.speed)),this.hasNextRoutePoint()&&this.nextRoutePoint()._refreshTimeOrSpeed()}}hasNextRoutePoint(){return null!=this.obstacle&&this.index+1<this.obstacle.getRoutePointCount()}hasPrevRoutePoint(){return this.index>0}nextRoutePoint(){return this.hasNextRoutePoint()?this.obstacle.getRoutePoint(this.index+1):null}prevRoutePoint(){return this.hasPrevRoutePoint()?this.obstacle.getRoutePoint(this.index-1):null}}