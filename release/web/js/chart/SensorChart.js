"use strict";function SensorChart(t){SensorChart.super(this),this.buffer=[],this.later(1,function(){this.init(),this.client=t.on("ros_info",this,function(){this.initChartData()}).on("topic_info",this,function(){this.refreshChartData()})})}Laya.class(SensorChart,"SensorChart",Laya.EventDispatcher),SensorChart.prototype.show=function(t){this.container&&(void 0===t&&(t=!0),this.container.style.display=t?"block":"none")},SensorChart.prototype.hide=function(){this.show(!1)},SensorChart.prototype.foreground=function(t){this.container&&(void 0===t&&(t=!0),this.container.style.zIndex=t?3e4:-3e4)},SensorChart.prototype.background=function(){this.foreground(!1)},SensorChart.prototype.later=function(t,e){var a=this;setTimeout(function(){e.apply(a)},t)},SensorChart.prototype.getColor=function(t){var e=function(t){var e=0,a=t.length,i=0;if(a>0)for(;i<a;)e=(e<<5)-e+t.charCodeAt(i++)|0;return e}(t);return"rgb("+((16711680&e)>>16)+", "+((65280&e)>>8)+", "+(255&e)+")"},SensorChart.prototype.init=function(){var t,e=this,a=document.getElementById("sensor-chart-container");a||((a=document.createElement("div")).style.left="0px",a.style.top="0px",a.style.width="1px",a.style.height="1px",a.style.position="absolute",a.style.zIndex=3e4,a.id="sensor-chart-container",document.getElementById("layaContainer").appendChild(a),window.addEventListener("resize",function(){t||(t=setTimeout(function(){t=null,e.rebind()},1e3))},!1));if(this.container=a,!this.chart){var i=document.createElement("canvas");a.appendChild(i),this.chart=new Chart(i,{type:"line",data:{},options:{maintainAspectRatio:!1,tooltips:{enabled:!1},hover:{mode:null},scales:{xAxes:[{type:"realtime",display:!0,scaleLabel:{display:!0,labelString:"Time"},time:{unit:"second",displayFormats:{second:"mm:ss"}}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Value"}}]},plugins:{streaming:{duration:6e4,delay:1e3,onRefresh:function(t){e.consumeChartData(t)}}}}})}},SensorChart.prototype.bind=function(t){if(this.container)if(this.page=t,t&&t.m_uiSensorChart){var e=t.m_uiSensorChart.localToGlobal(new Laya.Point(0,0)),a=t.m_uiSensorChart.localToGlobal(new Laya.Point(t.m_uiSensorChart.width,t.m_uiSensorChart.height)),i=Laya.Browser.clientWidth/Laya.stage.width,n=Laya.Browser.clientHeight/Laya.stage.height;this.show(),this.container.style.left=e.x*i+"px",this.container.style.top=e.y*n+"px",this.container.style.width=(a.x-e.x)*i+"px",this.container.style.height=(a.y-e.y)*n+"px"}else this.hide()},SensorChart.prototype.rebind=function(){this.bind(this.page)},SensorChart.prototype.initChartData=function(){if(this.client.data.ros_info){var t={labels:[],datasets:[]},e=this;this.client.data.ros_info.config.forEach(function(a){"raw_drive"!==a.name&&"AirSimDriver"!==a.name&&t.datasets.push({label:a.name,backgroundColor:e.getColor(a.name),borderColor:e.getColor(a.name),data:[],fill:!1})});var a=!1;this.chart.data&&this.chart.data.datasets&&this.chart.data.datasets.length===t.datasets.length&&(this.chart.data.datasets.forEach(function(e,i){e.label!==t.datasets[i].label&&(a=!0)}),!a)||(this.chart.data=t,this.chart.update())}},SensorChart.prototype.refreshChartData=function(){if(this.client.data.ros_info&&this.client.data.topic_info&&this.chart)for(this.chart.data.datasets&&0!==this.chart.data.datasets.length||this.initChartData(),this.buffer.push({timestamp:new Date,topic_info:JSON.parse(JSON.stringify(this.client.data.topic_info))});this.buffer.length>1e4;)this.buffer.shift()},SensorChart.prototype.consumeChartData=function(t){t=t||this.chart,this.buffer.forEach(function(e){e.topic_info.hz_info.forEach(function(a,i){var n=t.data.datasets[i];n&&n.data.push({x:e.timestamp,y:a})})}),this.buffer.length=0};