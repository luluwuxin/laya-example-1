var RoutePointEvent={LINK_LINE_CHANGED:"link line changed"};class RoutePoint2D extends ObjectPoint{constructor(e,t,i,s,n){super(ObjectPointType.OBSTACLE_ROUTE_POINT),null!=e&&(this.x=e.vec3.x,this.y=e.vec3.y,this.z=e.vec3.z,this.rotation=2*Math.atan2(e.quat.z,e.quat.w)/Math.PI*180),this.timestampInterval=i,this.speed=s,this.isReversing=t,this.lockType=n}getTimestampSec(){return-1==this.index?0:this.hasPrevRoutePoint()?this.prevRoutePoint().getTimestampSec()+this.timestampInterval:this.timestampInterval}clone(){var e=new RoutePoint2D;return e.x=this.x,e.y=this.y,e.z=this.z,e.rotation=this.rotation,e.isReversing=this.isReversing,e.timestampInterval=this.timestampInterval,e.speed=this.speed,e.lockType=this.lockType,e}toJson(){var e=this.rotation/180*Math.PI;return{quat:{x:0,y:0,z:Math.sin(e/2),w:Math.cos(e/2)},tran:{x:this.x,y:this.y,z:this.z},is_reversing:this.isReversing,timestamp_interval:this.timestampInterval,speed:this.speed,lock_type:this.lockType}}_setValueInternal(...e){return super.setValue(...e)}setValue(...e){var t=super.setValue(...e);if(0!=t.size){var i=n(["isReversing","x","y","rotation"]),s=n(["timestampInterval","speed"]);assert(!(i&&s)),s&&this._refreshTimeOrSpeed(t),i&&(this.hasPrevRoutePoint()&&this.prevRoutePoint()._refreshLinkLine(),this._refreshLinkLine(),this._refreshTimeOrSpeed())}function n(e){for(var i of e)if(t.has(i))return!0;return!1}}static getBezierControlPoint(e,t){function i(e,t,i,s){var n=e.rotation/180*Math.PI,r=Math.sin(n),h={x:Math.cos(n),y:r};return i&&(h={x:-h.x,y:-h.y}),0==t&&(h={x:-h.x,y:-h.y}),new Vec2(e.x+h.x*s,e.y+h.y*s)}var s=Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2),n=Math.min(500,s/2.5);return[i(e,!0,e.isReversing,n),i(t,!1,e.isReversing,n)]}_refreshLinkLine(){this.hasNextRoutePoint()?(this.bezierCurve=function(){var e=this.nextRoutePoint(),t=new Vec2(this.x,this.y),i=new Vec2(e.x,e.y),s=RoutePoint2D.getBezierControlPoint(this,e);return new CubicBezierCurve(t,s[0],s[1],i)}.call(this),this.linkLineLength=this.bezierCurve.getLength()):(this.bezierCurve=null,this.linkLineLength=0),this.sendEvent(RoutePointEvent.LINK_LINE_CHANGED,this.bezierCurve)}_refreshTimeOrSpeed(e=null){if(this.hasPrevRoutePoint()){var t=this.prevRoutePoint(),i=t.linkLineLength,s=t.speed;(null==e||!e.has("speed"))&&(!(null==e||!e.has("timestampInterval"))||this.lockType==RoutePointLockType.TIMESTAMP_FROM_PREV_POINT)?this._setValueInternal("speed",2*i/this.timestampInterval-s):this._setValueInternal("timestampInterval",2*i/(s+this.speed))}this.hasNextRoutePoint()&&this.nextRoutePoint()._refreshTimeOrSpeed()}afterAdded(){this._refreshLinkLine(),this.hasPrevRoutePoint()&&this.prevRoutePoint()._refreshLinkLine(),this._refreshTimeOrSpeed()}afterRemoved(){var e=this.prevRoutePoint();null!=e&&e._refreshLinkLine();var t=this.getOwner();this.index<t.getRoutePointCount()&&t.getRoutePoint(this.index)._refreshTimeOrSpeed()}}