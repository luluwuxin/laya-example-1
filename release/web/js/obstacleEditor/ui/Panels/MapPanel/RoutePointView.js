function RoutePointViewScript(t,i){function e(t,i){this.update(i)}function o(t,i,e){e===this._routePoint&&this._onSelected(!1),i===this._routePoint&&this._onSelected(!0)}function n(){this.stopDragging()}function s(){this.inDraggingMode=!0,this._historyManager.disableRecordHistory(),this.followMouse()}function a(){this.stopDragging()}function h(){this.stopRotation()}function r(){this.inRotationMode=!0,this._historyManager.disableRecordHistory();var t=180*(this.getCurrentMouseRadian()-this._initMouseRadianRotationMode)/Math.PI+this._initRotationRotationMode;t=MathHelper.normalizeDegree(t),this._routePoint.setValue("rotation",t)}function _(){this.stopRotation()}this.stopDragging=function(){this.inDraggingMode&&(this.inDraggingMode=!1,this._historyManager.enableRecordHistory()),this.watchMouseMoveDragMode(!1)},this.watchMouseMoveDragMode=function(t){t?(this._mapPanelScript.mainContainer.on(Event.MOUSE_MOVE,this,s),this._mapPanelScript.mainContainer.on(Event.MOUSE_OUT,this,a),this._mapPanelScript.mainContainer.on(Event.MOUSE_UP,this,n)):(this._mapPanelScript.mainContainer.off(Event.MOUSE_MOVE,this,s),this._mapPanelScript.mainContainer.off(Event.MOUSE_OUT,this,a),this._mapPanelScript.mainContainer.off(Event.MOUSE_UP,this,n))},this.followMouse=function(){var t=this._obstacleUI.obstacleContainer.mouseX+this._initMoveOffsetX,i=this._obstacleUI.obstacleContainer.mouseY+this._initMoveOffsetY,e=this._loadedDataManager.mapData.uiToMapPosition({x:t,y:i});this._routePoint.setValue("x",e.x,"y",e.y)},this.getCurrentMouseRadian=function(){var t=this.mouseX-this.anchorX*this.width,i=this.mouseY-this.anchorY*this.height;return Math.atan2(i,t)},this.stopRotation=function(){this.inRotationMode=!1,this._historyManager.enableRecordHistory(),this.watchMouseMoveRotationMode(!1)},this.watchMouseMoveRotationMode=function(t){t?(this._mapPanelScript.mainContainer.on(Event.MOUSE_MOVE,this,r),this._mapPanelScript.mainContainer.on(Event.MOUSE_OUT,this,_),this._mapPanelScript.mainContainer.on(Event.MOUSE_UP,this,h)):(this._mapPanelScript.mainContainer.off(Event.MOUSE_MOVE,this,r),this._mapPanelScript.mainContainer.off(Event.MOUSE_OUT,this,_),this._mapPanelScript.mainContainer.off(Event.MOUSE_UP,this,h))},this.destroy=function(){Object.getPrototypeOf(this).destroy.call(this),this._routePoint.unregisterEvent(ObjectEvent.VALUE_CHANGED,this,e),this._user.unregisterEvent(UserEvent.ROUTE_POINT_SELECTED,this,o)},this.update=function(t){var i=this._routePoint.index;if(this._routePoint.pointType!=ObjectPointType.MAIN_CAR_START_POINT&&(null==t||t.has("index"))&&(this.indexLabel.text=i.toString()),null==t||t.has("x")||t.has("y")){var e=this._loadedDataManager.mapData.mapToUIPosition({x:this._routePoint.x,y:this._routePoint.y});this.x=e.x,this.y=e.y}(null==t||t.has("rotation"))&&(this.arrowImage.rotation=this._routePoint.rotation)},this._onSelected=function(t){this.selectedMark.visible=t},RoutePointViewScript.super(this),DependencesHelper.setDependencesByParent(this,t,"obstacleUI"),this._user=this._dependences.user,this._routePoint=i,this.anchorX=.5,this.anchorY=.5;var u=this._routePoint.pointType,c=u==ObjectPointType.MAIN_CAR_START_POINT||u==ObjectPointType.OBSTACLE_ROUTE_POINT;this._routePoint.registerEvent(ObjectEvent.VALUE_CHANGED,this,e),this._user.registerEvent(UserEvent.ROUTE_POINT_SELECTED,this,o),this.dragButton.on(Event.MOUSE_DOWN,this,function(t){this._user.selectSceneObject(this._routePoint.getOwner()),this._user.selectRoutePoint(this._routePoint),t.stopPropagation(),this.inDraggingMode=!1,this.watchMouseMoveDragMode(!0),this._initMoveOffsetX=this.x-this._obstacleUI.obstacleContainer.mouseX,this._initMoveOffsetY=this.y-this._obstacleUI.obstacleContainer.mouseY}),c&&this.rotationButton.on(Event.MOUSE_DOWN,this,function(t){t.stopPropagation(),this.inRotationMode=!0,this.watchMouseMoveRotationMode(!0),this._initMouseRadianRotationMode=this.getCurrentMouseRadian(),this._initRotationRotationMode=this._routePoint.rotation}),this.arrowImage.visible=c,this._routePoint.pointType==ObjectPointType.MAIN_CAR_START_POINT&&(this.indexLabel.text="S"),this._onSelected(!1)}Laya.class(RoutePointViewScript,"RoutePointViewScript",RoutePointViewUI);