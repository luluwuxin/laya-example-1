"use strict";function CarRenderer(e){CarRenderer.super(this),this.layer=2,this.parent=e,this.scene=e.addChild(new Laya.Scene),this.camera=this.scene.addChild(new Laya.Camera),this.camera.transform.position=new Laya.Vector3(0,6,6),this.camera.transform.rotate(new Laya.Vector3(-45,0,0),!0,!1),this.camera.addComponent(CameraMoveScript),this.spot=this.scene.addChild(new Laya.SpotLight),this.spot.diffuseColor=new Laya.Vector3(1,1,1),this.spot.transform.position=new Laya.Vector3(0,10,10),this.spot.direction=new Laya.Vector3(0,-1,-1),this.spot.range=20,this.spot.spot=5,this.light=this.scene.addChild(new Laya.DirectionLight),this.light.diffuseColor=new Laya.Vector3(1,1,1),this.light.direction=new Laya.Vector3(0,-1,1);var a=e.localToGlobal(new Laya.Point(0,0)),t=e.localToGlobal(new Laya.Point(640,480));this.camera.viewport=new Laya.Viewport(a.x,a.y,t.x-a.x,t.y-a.y);var r=this.camera;setTimeout(function(){var a=e.localToGlobal(new Laya.Point(0,0)),t=e.localToGlobal(new Laya.Point(e.width,e.height));r.viewport=new Laya.Viewport(a.x,a.y,t.x-a.x,t.y-a.y)},1),this.sensors=[]}Laya.class(CarRenderer,"CarRenderer",Laya.EventDispatcher),CarRenderer.prototype.loadCar=function(e){this.carObj=this.scene.addChild(Laya.Sprite3D.load(e)),this.carObj.layer=Laya.Layer.getLayerByNumber(this.layer),this.carObj.on(Laya.Event.HIERARCHY_LOADED,this,function(e){!function e(a){var t=0,r=void 0;if("function"==typeof a.getChildAt)for(;r=a.getChildAt(t++);)e(r);"object"==typeof a.meshRender&&a.meshRender.sharedMaterials.forEach(function(e){"T_jeep_chenei_01"!==e.name&&(e.reflectTexture=Laya.TextureCube.load("skyBox/skyCube.ltc"),e.reflectColor=new Laya.Vector3(.3,.3,.3))})}(e)})},CarRenderer.prototype.loadAxis=function(){var e=this.scene.addChild(new Laya.MeshSprite3D(new Laya.BoxMesh(2,.1,.1)));(t=new Laya.StandardMaterial).albedo=new Laya.Vector4(1,0,0,1),t.disableLight(),e.meshRender.material=t,e.transform.position=new Laya.Vector3(1,0,0);var a=this.scene.addChild(new Laya.MeshSprite3D(new Laya.BoxMesh(.1,.1,2)));(t=new Laya.StandardMaterial).albedo=new Laya.Vector4(0,1,0,1),t.disableLight(),a.meshRender.material=t,a.transform.position=new Laya.Vector3(0,1,0);var t,r=this.scene.addChild(new Laya.MeshSprite3D(new Laya.BoxMesh(.1,2,.1)));(t=new Laya.StandardMaterial).albedo=new Laya.Vector4(0,0,1,1),t.disableLight(),r.meshRender.material=t,r.transform.position=new Laya.Vector3(0,0,1)},CarRenderer.prototype.refreshCarConfig=function(e){for(var a=this.sensors.length;a<e.config.length;a++){var t=this.scene.addChild(new Laya.MeshSprite3D(new SensorMesh(.5,1)));t.layer=Laya.Layer.getLayerByNumber(this.layer);var r=new Laya.StandardMaterial;r.renderMode=Laya.StandardMaterial.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE,r.disableLight(),t.meshRender.material=r,t.addComponent(Laya.MeshCollider).mesh=t.meshFilter.sharedMesh,this.sensors.push(t)}for(a=e.config.length;a<this.sensors.length;a++)this.sensors[a].destroy();this.sensors.length=e.config.length,this.sensors.forEach(function(a,t){var r=e.config[t],n=a.transform,o=a.meshRender.material,i=new Laya.Vector3(3,3,3);switch(r.type){case 0:o.albedo=new Laya.Vector4(113/255,219/255,223/255,.3);break;case 1:o.albedo=new Laya.Vector4(228/255,191/255,227/255,.3),i.x*=1.1,i.y=i.z=.9*i.z;break;case 2:o.albedo=new Laya.Vector4(207/255,249/255,162/255,.3),i.x*=.9,i.y=i.z=1.1*i.z;break;default:o.albedo=new Laya.Vector4(1,0,0,.3)}var s=new Laya.Vector3(r.x/100,r.z/100,r.y/100),h=new Laya.Vector3(r.roll,-r.yaw,r.pitch),y=i;n.localRotationEuler=h.clone(),n.localScale=y.clone(),n.position=s.clone(),a.pickingInfo=JSON.stringify({type:"sensor",sid:r.sid})})},CarRenderer.prototype.select=function(e,a){var t=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0)),r=new Laya.RaycastHit,n=new Laya.Vector2;if(n.elements[0]=e,n.elements[1]=a,this.camera.viewportPointToRay(n,t),Laya.Physics.rayCast(t,r,void 0,this.layer),r.sprite3D&&"string"==typeof r.sprite3D.pickingInfo)try{return JSON.parse(r.sprite3D.pickingInfo)}catch(e){}};