function ScenarioUI(e,i){ScenarioUI.super(this),this.initSelectSceneUI(),this.initScenarioListUI(),this.pageChooser=e,this.modalBlocker=new ModalBlocker(this),this.bannerControl=new BannerControl(e,{m_uiBanner_logo:this.m_uiBanner_logo,m_uiBanner_home:this.m_uiBanner_home,m_uiBanner_setup:this.m_uiBanner_setup,m_uiBanner_scene:this.m_uiBanner_scene,m_uiBanner_scenario:this.m_uiBanner_scenario}),this.sensorControl=new SensorControl(e,i,{m_uiSensorButton1:this.m_uiSensorButton1,m_uiSensorButton2:this.m_uiSensorButton2,m_uiSensorButton3:this.m_uiSensorButton3,m_uiSensorList:this.m_uiSensorList}),this.drivingControl=new DrivingControl(i,{m_uiDriveButton1:this.m_uiDriveButton1,m_uiDriveButton2:this.m_uiDriveButton2,m_uiDriveButton3:this.m_uiDriveButton3,m_uiDrive_speed:this.m_uiDrive_speed,m_uiDrive_accer:this.m_uiDrive_accer,m_uiDrive_steerSlider:this.m_uiDrive_steerSlider,m_uiDrive_steerImage:this.m_uiDrive_steerImage}),this.initDrivingControlUI(),this.client=i.on("case_list",this,function(){this.refreshScenarioListUI()}).on("scene_list",this,function(){this.refreshSelectSceneUI()}).on("loading",this,function(){this.modalBlocker.resume()})}Laya.class(ScenarioUI,"ScenarioUI",ScenarioPageUI),ScenarioUI.prototype.refreshSelectSceneUI=function(){var e=[],i=new Set(["IndustrialCity","Parking"]),t=this.client.data.scene_list.data;for(var n of t){var s=n.scene,o=i.has(s);e.push({sceneName:s,label:{text:s+(o?"":" (DISABLED)")},image:{skin:n.image,gray:!o},sceneValid:o})}this.selectSceneList.array=e},ScenarioUI.prototype.initSelectSceneUI=function(){this.selectScenePanel.visible=!1,this.selectScenePanel.getChildByName("cancelButton").on(Event.CLICK,this,function(){this.selectScenePanel.visible=!1}),this.selectSceneList.mouseHandler=new Handler(this,function(e){if(e.type==Event.CLICK&&e.target.dataSource.sceneValid){var i=e.target.dataSource.sceneName;this.client.case.insertDefault(i),this.client.storeCases(),this.refreshScenarioListUI(),this.selectScenePanel.visible=!1,this.m_uiScenarioList.selectedIndex=this.m_uiScenarioList.array.length-1}})},ScenarioUI.prototype.initScenarioListUI=function(){function e(e,i){this.pageChooser.sensorChart.hide();var t=new AskPopupWindowScript("Do you want to delete\n[{0}]?".format(e),this,function(){this.client.case.removeCase(e),this.client.storeCases(),this.refreshScenarioListUI();var i=this.m_uiScenarioList.selectedIndex;this.m_uiScenarioList.selectedIndex=-1,this.m_uiScenarioList.selectedIndex=i},function(){});t.popup(),t.closeHandler=new Laya.Handler(this,function(e){this.pageChooser.sensorChart.show()})}function i(e,i){this.pageChooser.sensorChart.show(!1);var t=Object.assign({},this.client.case.getSelectedCase()),n=new ObstacleEditor;n.createMainUI(this),n.registerEvent(ObstacleEditorEvent.USER_SAVE_CASE,this,function(e,i){t.content=i,this.client.case.insert(t),this.client.storeCases()}),n.registerEvent(ObstacleEditorEvent.USER_CLOSE_EDITOR,this,function(e,i){this.pageChooser.sensorChart.show(!0)}),n.loadMapData(t.scene,t.scene_config),n.loadCaseData(t.content)}function t(e){null==e?this.client.case.selectCase(null):this.client.case.selectCase(e.name)}this.m_uiScenarioList.array=[],this.m_uiScenarioList.renderHandler=new Handler(this,function(t,n){var s=this.client.case.getList(),o=t.getChildByName("label"),a=t.getChildByName("editButton"),r=t.getChildByName("removeButton"),c=t.getChildByName("selectedMark"),h=s[n].name,l=h==this.client.case.getSelectedCaseId();o.text=s[n].name,a.visible=l,c.visible=l,r.visible=l,a.on(Event.CLICK,this,i,[h]),r.on(Event.CLICK,this,e,[h])}),this.m_uiScenarioList.on(Laya.Event.CHANGE,this,function(){var e=this.client.case.getList();if(-1==this.m_uiScenarioList.selectedIndex)t.call(this,null);else{var i=e[this.m_uiScenarioList.selectedIndex];t.call(this,i)}}),this.m_uiScenarioButton.on(Laya.Event.CLICK,this,function(){this.selectScenePanel.visible=!0})},ScenarioUI.prototype.initDrivingControlUI=function(){this.drivingControl.on(DrivingControl.BEFORE_START,this,function(){var e=this.client.case.getSelectedCase();e&&(this.client.data.scene_info.scene!==e.scene&&(this.client.data.scene_info.scene=e.scene),this.client.send("scene_info"),this.modalBlocker.block(),this.client.sendCase(e))})},ScenarioUI.prototype.refreshScenarioListUI=function(){var e=[];this.client.case.getList().forEach(function(i,t){e.push({label:{text:i.name}})}),this.m_uiScenarioList.array=e};