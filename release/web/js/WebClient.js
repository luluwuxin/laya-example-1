"use strict";var WebClient=function(t,i,n){function s(){this.data={},this.case=new WebClientCase,this.callbacks={},this.init()}return s.prototype.init=function(){this.socket=new i.Socket,this.socket.endian=i.Byte.LITTLE_ENDIAN,this.socket.connectByUrl("ws://"+(t.location.host||"localhost:8081")),this.socket.on(i.Event.OPEN,this,function(t){n.info("WebSocket open: "+t.target.url),this.initHardcodeData(),this.sendJson({method:"auth",type:0})}),this.socket.on(i.Event.MESSAGE,this,function(t){if("string"!=typeof t)throw new Error("WebSocket received unsupported data.");var i;try{i=JSON.parse(t)}catch(i){throw n.error("WebSocket received invalid json: "+t),i}this.handleJsonMessage(i)}),this.socket.on(i.Event.CLOSE,this,function(t){n.info("WebSocket close: "+t.target.url);var i=this;setTimeout(function(){i.init()},1e3)}),this.socket.on(i.Event.ERROR,this,function(t){n.error("WebSocket error: "+t.target.url)})},s.prototype.handleJsonMessage=function(t){switch(n.info("WebSocket receive: "+t.method),n.info(t),t.method){case"case_list":this.case.init(t);break;default:this.data[t.method]=JSON.parse(JSON.stringify(t))}this.fire(t.method)},s.prototype.send=function(t){this.sendJson(this.data[t]);var i=this;setTimeout(function(){i.fire(t)},1)},s.prototype.sendJson=function(t){n.info("WebSocket send: "+(t.method||"")),n.info(t),this.socket.send(JSON.stringify(t))},s.prototype.on=function(t,i,n){return this.callbacks[t]=this.callbacks[t]||[],this.callbacks[t].push({self:i,handler:n}),this},s.prototype.fire=function(t){return this.callbacks[t]&&this.callbacks[t].forEach(function(t){t.handler.apply(t.self)}),this},s.prototype.addCarConfig=function(){if(this.data.car_config&&this.data.car_config_list){var t="New Preset #",i=1;this.data.car_config_list.list.forEach(function(n){if(n.name.startsWith(t)){var s=parseInt(n.name.substr(t.length));s&&(i=s+1)}}),this.data.car_config_list.list.push({name:t+i,car_config:JSON.parse(JSON.stringify(this.data.car_config))}),this.send("car_config_list")}},s.prototype.loadCarConfig=function(t){if(this.data.car_config&&this.data.car_config_list){var i=this;this.data.car_config_list.list.forEach(function(n){n.name===t&&(i.data.car_config=JSON.parse(JSON.stringify(n.car_config)))}),this.send("car_config")}},s.prototype.removeCarConfig=function(t){this.data.car_config&&this.data.car_config_list&&(this.data.car_config_list.list=this.data.car_config_list.list.filter(function(i){return i.name!==t}),this.send("car_config_list"))},s.prototype.saveCarConfig=function(t){if(this.data.car_config&&this.data.car_config_list){var i=!1,n=this;this.data.car_config_list.list.forEach(function(s){s.name===t&&(s.car_config=JSON.parse(JSON.stringify(n.data.car_config)),i=!0)}),i&&this.send("car_config_list")}},s.prototype.renameCarConfig=function(t,i){if(!this.data.car_config||!this.data.car_config_list)return t;var n=!1;if(this.data.car_config_list.list.forEach(function(t){t.name===i&&(n=!0)}),n)return this.fire("car_config_list"),t;return this.data.car_config_list.list.forEach(function(n){n.name===t&&(n.name=i)}),this.send("car_config_list"),i},s.prototype.addSensor=function(t){if(this.data.car_config){var i=-1;this.data.car_config.config.forEach(function(t){i=Math.max(i,t.sid)}),t.sid=i+1,this.data.car_config.config.push(t),this.send("car_config")}},s.prototype.removeSensor=function(t){this.data.car_config&&(this.data.car_config.config=this.data.car_config.config.filter(function(i){return i.sid!==t}),this.send("car_config"))},s.prototype.storeCases=function(){this.sendJson(this.case.toJson())},s.prototype.sendRosInfo=function(t){var i=JSON.parse(JSON.stringify(this.data.ros_info));i.config.forEach(function(t){"raw_drive"!==t.name&&"AirSimDriver"!==t.name||(t.running=!0)}),Object.assign(i,{status:t}),this.sendJson(i)},s.prototype.sendSumoInfo=function(t){this.sendJson({method:"sumo_info",status:t})},s.prototype.sendDriveInfo=function(t){this.sendJson({method:"drive_info",status:t})},s.prototype.sendCase=function(t){this.sendJson(Object.assign({method:"case_info"},t))},s.prototype.initHardcodeData=function(){this.handleJsonMessage({method:"scene_list",data:[{scene:"IndustrialCity",image:"custom/image_scene_IndustrialCity.png"},{scene:"ShengBangJie",image:"custom/image_scene_ShengBangJie.png"},{scene:"Shanghai",image:"custom/image_scene_Shanghai.png"},{scene:"Parking",image:"custom/image_scene_Parking.png"}]})},s}(window,Laya,console);